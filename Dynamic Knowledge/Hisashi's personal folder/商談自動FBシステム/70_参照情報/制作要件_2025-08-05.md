# リアルタイム商談アドバイザー 最新版仕様書
**更新日: 2025年8月5日**

## 1. システム概要

### 1.1 目的
Zoom商談中に、リアルタイムでAIが商談内容を分析し、営業担当者向けの具体的なアドバイスを画面に表示する。高単価のデザインスクールを販売するコンサルティングセールスを成功に導くためのサポートシステム。

### 1.2 技術スタック
- **音声認識**: OpenAI Whisper API (gpt-4o-transcribe)
- **AI分析**: Google Gemini 2.5 Flash
- **バックエンド**: Python (FastAPI + WebSocket)
- **フロントエンド**: HTML/JavaScript (リアルタイム更新)
- **音声入力**: PyAudio

## 2. 主要機能

### 2.1 高精度音声認識（Whisper）
- **モデル**: gpt-4o-transcribe（最新・高精度）
- **プロンプト最適化**: 専門用語と文脈を含む動的プロンプト生成
- **文脈保持**: 過去10チャンクの会話を記憶して認識精度向上
- **専門用語ブースト**: デザイン関連用語を事前登録＋動的追加可能

### 2.2 オーバーラップバッファリング
- **30秒チャンク処理**: 適切な長さで音声を分割
- **5秒オーバーラップ**: チャンクの境界で音声が途切れない
- **重複自動除去**: オーバーラップ部分の重複を検出・除去
- **完全な音声キャプチャ**: 話の内容を一切削らない

### 2.3 AI商談アドバイス
- **Gemini 2.5 Flash**: 高速で的確なアドバイス生成
- **商談フェーズ自動判定**: 診断/再定義/未来提示/決断促進
- **リアルタイム顧客情報抽出**: 名前、会社、課題、予算、期限など
- **優先度付きアドバイス**: 🔴緊急/🟡重要/🟢通常

### 2.4 柔軟な分析タイミング
- **自動分析**: 6チャンク（約3分）ごとに自動実行
- **手動分析**: 「🧠 今すぐアドバイスを生成」ボタンでいつでも実行
- **音声取りこぼし防止**: AI分析中も録音は継続

### 2.5 インタラクティブ機能
- **事前情報入力**: 商談前の顧客情報を設定可能
- **専門用語の動的追加**: UIから認識させたい用語を追加
- **カスタム質問**: AIに直接質問して即座に回答を取得
- **クイック質問ボタン**: よく使う質問をワンクリックで

## 3. 実装の特徴

### 3.1 エラーハンドリング
- **Gemini APIブロック対策**: 安全性フィルタ回避とフォールバック機能
- **多様なフォールバックアドバイス**: ランダムに選択される実践的な提案
- **システム継続性**: エラーが発生してもシステムは停止しない

### 3.2 UI/UX
- **信頼度表示**: 音声認識の精度をパーセンテージで表示
- **タイムスタンプ付き文字起こし**: いつ話されたかが明確
- **視覚的な優先度表示**: 色分けでアドバイスの重要度を表現
- **レスポンシブデザイン**: 商談中でも邪魔にならないシンプルなUI

### 3.3 パフォーマンス
- **低遅延処理**: 30秒ごとの効率的な音声処理
- **メモリ管理**: 累積トランスクリプトの自動調整
- **非同期処理**: 音声録音と分析を並行実行

## 4. 営業ナレッジの組み込み

### 4.1 営業の心構え（5原則）
1. 営業マンではなく「医者」であれ
2. 商品を売るな、「未来」を売れ
3. 問題を解決するな、「問題を再定義」せよ
4. 論破するな、「最強の味方」になれ
5. ロジックで説得するな、「愛」で背中を押せ

### 4.2 フェーズ別アクション
- **診断フェーズ**: 徹底的な傾聴、5W深掘り
- **再定義フェーズ**: 業界の常識の嘘を指摘
- **未来提示フェーズ**: ロードマップで道筋を示す
- **決断促進フェーズ**: 反論を共感で受け止める

## 5. 実行環境

### 5.1 必要な設定
- OpenAI APIキー（Whisper用）
- Google Gemini APIキー（既に設定済み）
- Python 3.8以上
- 必要なライブラリ（requirements.txt参照）

### 5.2 起動方法
```bash
cd sales-advisor-system
python3 app_whisper_advanced.py
```

### 5.3 アクセス
ブラウザで http://localhost:8001 にアクセス

## 6. 今後の改善案

### 6.1 機能拡張
- 商談の録音・保存機能
- 商談サマリーの自動生成
- 複数商談の履歴管理
- データのエクスポート機能

### 6.2 技術的改善
- Realtime API（WebSocket）への移行検討
- マルチユーザー対応
- クラウドデプロイ対応
- より高度な話者分離

## 7. 変更履歴

### 2025年8月5日の改善点
1. OpenAI Whisper API (gpt-4o-transcribe)への移行
2. オーバーラップバッファリングの実装
3. 30秒チャンク処理への最適化
4. 手動アドバイス生成ボタンの追加
5. Gemini APIのエラーハンドリング強化
6. フォールバックアドバイス機能の実装
7. 専門用語の動的追加機能
8. 信頼度表示の追加

## 8. 備考

- 本システムは1ファイル（app_whisper_advanced.py）で完結
- 非エンジニアでも使いやすい設計
- リアルタイムでの商談サポートに特化
- 音声の取りこぼしがない完全なナレッジ化を実現